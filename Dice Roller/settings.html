<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dice Roller Settings</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="container settings-page">
    <header class="top settings-top">
      <div class="top-bar">
        <h1>Supabase Settings</h1>
      </div>
      <div class="top-actions">
        <nav class="page-nav" aria-label="Page navigation">
          <a class="link-button" href="index.html">Roll Dice</a>
          <a class="link-button" href="history.html">Past Saved Data</a>
          <a class="link-button" href="trends.html">View Trends</a>
          <a class="link-button" href="settings.html" aria-current="page">Supabase Settings</a>
        </nav>
      </div>
      <p class="settings-intro">Sign in with a Supabase email/password user so roll history can sync while RLS remains enabled. The project connection is preconfigured for you.</p>
    </header>

    <section class="supabase" aria-labelledby="supabase-heading">
      <div class="supabase-header">
        <h2 id="supabase-heading">Supabase Sync</h2>
        <p class="supabase-help">Store your roll history in our configured Supabase project. Nothing is sent unless sync is enabled.</p>
      </div>
      <form id="supabase-form" class="supabase-form">
        <label class="field">
          <span>Table</span>
          <input id="supabase-table" type="text" placeholder="dice_rolls" autocomplete="off">
        </label>
        <fieldset class="auth">
          <legend>Authentication (required when RLS is enabled)</legend>
          <p class="supabase-help auth-help">Sign in with a Supabase email/password user who is allowed to insert into the table. Passwords are never stored.</p>
          <label class="field">
            <span>Email</span>
            <input id="supabase-email" type="email" placeholder="dice@example.com" autocomplete="email">
          </label>
          <label class="field">
            <span>Password</span>
            <input id="supabase-password" type="password" placeholder="Supabase password" autocomplete="current-password">
          </label>
          <div class="auth-buttons">
            <button id="supabase-login" type="button">Sign in</button>
            <button id="supabase-logout" type="button">Sign out</button>
          </div>
        </fieldset>
        <label class="toggle">
          <input id="supabase-sync" type="checkbox">
          <span>Enable Supabase sync</span>
        </label>
        <button type="submit">Save Supabase Settings</button>
      </form>
      <details class="supabase-note">
        <summary>How the data is saved</summary>
        <p>Each roll is inserted into the selected table with the columns <code>rolled_at</code> (timestamp), <code>dice_count</code>, <code>sides</code>, <code>values</code> (array), <code>total</code>, <code>average</code>, and <code>user_id</code> (UUID). When RLS is on, add a policy such as <code>using (auth.uid() = user_id) with check (auth.uid() = user_id)</code> so that authenticated users can insert their own rolls.</p>
      </details>
    </section>

    <footer class="page-footer">
      <p id="supabase-status" class="supabase-status supabase-status--footer" role="status" aria-live="polite">Supabase sync is disabled.</p>
    </footer>
  </main>

  <script type="module" src="settings.js"></script>
</body>
</html>
