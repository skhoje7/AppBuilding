<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Expense Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* ===== Design tokens ===== */
    :root{
      --bg:#0b0f14; --card:#121822; --text:#ecf2f8; --muted:#9aa4af;
      --accent:#60a5fa; --danger:#f87171;
      --chip:#0f1620; --line:#1f2a37; --ring:#2b3a4b;
      --shadow:0 18px 50px rgba(0,0,0,.35);
      --radius:18px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f8fb; --card:#ffffff; --text:#0d1117; --muted:#667085;
        --accent:#2563eb; --danger:#dc2626;
        --chip:#f8fafc; --line:#e6e8ee; --ring:#cfd7e3;
        --shadow:0 20px 55px rgba(16,24,40,.10);
      }
    }

    /* ===== Base ===== */
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial}
    .container{max-width:1180px;margin:0 auto;padding:28px}
    header h1{margin:0 0 6px;font-size:32px;letter-spacing:.2px}
    .muted{color:var(--muted)}

    /* ===== Tabs ===== */
    .tabs{display:flex;gap:10px;margin:18px 0 8px;border-bottom:1px solid var(--line)}
    .tab{padding:12px 18px;cursor:pointer;border:1px solid transparent;border-bottom:0;
      border-radius:14px 14px 0 0;font-weight:700;opacity:.8;user-select:none}
    .tab.active{opacity:1;background:var(--card);border-color:var(--line);box-shadow:var(--shadow)}
    .page{display:none}
    .page.active{display:block}

    /* ===== Layout / Cards ===== */
    .grid{display:grid;gap:20px}
    .grid-2{grid-template-columns:1fr 1fr}
    .grid-3{grid-template-columns:repeat(3,1fr)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
      padding:20px;box-shadow:var(--shadow)}
    .card h2{margin:0 0 12px;font-size:20px}

    /* ===== Inputs ===== */
    label{display:flex;flex-direction:column;gap:6px;font-size:14px;flex:1}
    .row{display:flex;gap:12px;align-items:flex-end;margin:10px 0}
    .row.right{justify-content:flex-end}
    input,select,button{
      border-radius:12px;border:1px solid var(--ring);padding:10px 12px;outline:none
    }
    input,select{background:#0f141c;color:var(--text)}
    @media (prefers-color-scheme: light){ input,select{background:#fff;color:var(--text)} }
    button{cursor:pointer;border:1px solid var(--accent);background:var(--accent);color:#fff;font-weight:700}
    button.secondary{background:transparent;border-color:var(--ring);color:var(--text)}
    button.danger{background:transparent;border-color:var(--danger);color:var(--danger)}

    /* ===== KPIs ===== */
    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .kpi{background:linear-gradient(180deg, color-mix(in oklab,var(--card) 80%, transparent), color-mix(in oklab,var(--card) 60%, transparent));
      border:1px solid var(--line);border-radius:16px;padding:16px 18px;box-shadow:var(--shadow)}
    .kpi .label{color:var(--muted);font-size:12px;margin-bottom:6px}
    .kpi .value{font-size:28px;font-weight:800;letter-spacing:.3px}
    .kpi .sub{color:var(--muted);font-size:12px;margin-top:4px}

    /* ===== Charts ===== */
    .charts{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .chart-box{height:320px;padding:12px;border:1px dashed var(--line);border-radius:14px}
    canvas{width:100% !important;height:100% !important}

    /* ===== Table ===== */
    .table-wrap{overflow:auto;border:1px solid var(--line);border-radius:14px}
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:12px 14px;border-bottom:1px solid var(--line);text-align:left}
    th{background:color-mix(in oklab,var(--card) 80%, transparent)}
    td.right,th.right{text-align:right}

    /* ===== Responsive ===== */
    @media (max-width:980px){ .charts{grid-template-columns:1fr} .kpis{grid-template-columns:1fr 1fr} }
    @media (max-width:640px){ .grid-2,.grid-3{grid-template-columns:1fr} .kpis{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header class="container">
    <h1>ðŸ’¸ Expense Tracker</h1>
    <p class="muted">A tidy tracker with a slick, modern dashboard.</p>

    <div class="tabs">
      <div id="tab-expenses" class="tab active">Expenses</div>
      <div id="tab-dashboard" class="tab">Dashboard</div>
    </div>
  </header>

  <main class="container">
    <!-- EXPENSES PAGE -->
    <div id="page-expenses" class="page active">
      <div class="grid grid-2">
        <section class="card">
          <h2 id="form-title">Add Expense</h2>
          <form id="expense-form">
            <div class="row">
              <label>Date<input type="date" id="date" required /></label>
              <label>Category
                <select id="category" required>
                  <option value="">Selectâ€¦</option>
                  <option>Food</option><option>Transport</option><option>Shopping</option>
                  <option>Housing</option><option>Utilities</option><option>Health</option>
                  <option>Entertainment</option><option>Other</option>
                </select>
              </label>
            </div>
            <div class="row">
              <label>Description<input type="text" id="description" placeholder="e.g., Trader Joe's groceries" required /></label>
              <label>Amount ($)<input type="number" id="amount" step="0.01" min="0" required /></label>
            </div>
            <input type="hidden" id="editing-id" />
            <div class="row right">
              <button type="button" id="reset-btn" class="secondary">Reset</button>
              <button type="submit" id="save-btn">Save</button>
            </div>
          </form>
        </section>

        <section class="card">
          <h2>Filters & Summary</h2>
          <div class="row">
            <label>Month<input type="month" id="filter-month" /></label>
            <label>Category
              <select id="filter-category"><option value="">All</option>
                <option>Food</option><option>Transport</option><option>Shopping</option>
                <option>Housing</option><option>Utilities</option><option>Health</option>
                <option>Entertainment</option><option>Other</option>
              </select>
            </label>
            <label>Search<input type="search" id="filter-text" placeholder="Find in descriptionâ€¦" /></label>
          </div>
          <div class="kpis">
            <div class="kpi"><div class="label">This month</div><div class="value" id="kpi-total">$0.00</div><div class="sub" id="kpi-count">0 transactions</div></div>
            <div class="kpi"><div class="label">Top category</div><div class="value" id="kpi-topcat">â€”</div><div class="sub" id="kpi-topcat-amt">â€”</div></div>
            <div class="kpi"><div class="label">Avg / day</div><div class="value" id="kpi-avg">$0.00</div><div class="sub" id="kpi-days">across 0 days</div></div>
          </div>
        </section>

        <section class="card" style="grid-column:1/-1">
          <h2>Expenses</h2>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Date</th><th>Category</th><th>Description</th><th class="right">Amount</th><th>Actions</th></tr></thead>
              <tbody id="expense-tbody"></tbody>
            </table>
          </div>
          <p class="muted" id="empty-state" style="display:none;margin-top:8px">No expenses match your filters.</p>
        </section>
      </div>
    </div>

    <!-- DASHBOARD PAGE -->
    <div id="page-dashboard" class="page">
      <section class="card">
        <h2>Dashboard</h2>

        <!-- KPIs mirrored for quick view -->
        <div class="kpis" style="margin-bottom:6px">
          <div class="kpi"><div class="label">This month</div><div class="value" id="dkpi-total">$0.00</div><div class="sub" id="dkpi-count">0 transactions</div></div>
          <div class="kpi"><div class="label">Top category</div><div class="value" id="dkpi-topcat">â€”</div><div class="sub" id="dkpi-topcat-amt">â€”</div></div>
          <div class="kpi"><div class="label">Avg / day</div><div class="value" id="dkpi-avg">$0.00</div><div class="sub" id="dkpi-days">across 0 days</div></div>
        </div>

        <div class="charts">
          <div class="chart-box"><canvas id="catChart" aria-label="Spending by Category"></canvas></div>
          <div class="chart-box"><canvas id="dailyChart" aria-label="Daily Spend (Selected Month)"></canvas></div>
        </div>

        <div class="chart-box" style="margin-top:16px;height:360px">
          <canvas id="monthChart" aria-label="Monthly Trend"></canvas>
        </div>

        <p class="muted" style="margin-top:10px">Charts respect your filters. Switch to Expenses â†’ add/edit â†’ back here to refresh.</p>
      </section>
    </div>
  </main>

  <script>
    /* ===== Data + helpers ===== */
    const STORAGE_KEY="expense-tracker-data-v1"; let expenses=[];
    const cats=["Food","Transport","Shopping","Housing","Utilities","Health","Entertainment","Other"];
    const fmt=n=>(n??0).toLocaleString(undefined,{style:"currency",currency:"USD"});
    const uid=()=>crypto.randomUUID?.()||String(Date.now());

    /* ===== DOM refs ===== */
    const form=document.getElementById("expense-form"),tbody=document.getElementById("expense-tbody");
    const dateEl=document.getElementById("date"),catEl=document.getElementById("category"),descEl=document.getElementById("description"),amtEl=document.getElementById("amount"),editId=document.getElementById("editing-id");
    const filterMonth=document.getElementById("filter-month"),filterCat=document.getElementById("filter-category"),filterTxt=document.getElementById("filter-text");
    const empty=document.getElementById("empty-state");
    const kpis={ total:byId("kpi-total"), count:byId("kpi-count"), top:byId("kpi-topcat"), topAmt:byId("kpi-topcat-amt"), avg:byId("kpi-avg"), days:byId("kpi-days") };
    const dkpis={ total:byId("dkpi-total"), count:byId("dkpi-count"), top:byId("dkpi-topcat"), topAmt:byId("dkpi-topcat-amt"), avg:byId("dkpi-avg"), days:byId("dkpi-days") };
    const tabs={exp:byId("tab-expenses"),dash:byId("tab-dashboard")};
    const pages={exp:byId("page-expenses"),dash:byId("page-dashboard")};
    function byId(id){return document.getElementById(id)}

    /* ===== State & storage ===== */
    function load(){try{expenses=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]")}catch{}}
    function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(expenses))}
    function applyFilters(list){
      const m=filterMonth.value, c=filterCat.value, t=filterTxt.value.toLowerCase().trim();
      return list.filter(x=>(!m||x.date?.startsWith(m))&&(!c||x.category===c)&&(!t||x.description.toLowerCase().includes(t)))
    }

    /* ===== Rendering ===== */
    function render(){
      const f=applyFilters(expenses);
      // table
      tbody.innerHTML="";
      f.forEach(x=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${x.date}</td><td>${x.category}</td><td>${x.description}</td>
          <td class="right">${fmt(x.amount)}</td>
          <td>
            <button data-id="${x.id}" class="secondary edit">Edit</button>
            <button data-id="${x.id}" class="danger delete">Delete</button>
          </td>`;
        tbody.appendChild(tr);
      });
      empty.style.display=f.length?"none":"block";
      // KPIs
      updateKPIs(f, kpis); updateKPIs(f, dkpis);
      // Charts
      renderCharts(f);
    }

    function updateKPIs(f, target){
      const total=f.reduce((s,x)=>s+x.amount,0);
      const count=f.length;
      // category totals
      const totals=Object.fromEntries(cats.map(c=>[c,0]));
      f.forEach(e=>totals[e.category]=(totals[e.category]||0)+e.amount);
      const topCat = Object.entries(totals).sort((a,b)=>b[1]-a[1])[0] || ["â€”",0];

      // days in selected month
      const month=filterMonth.value || new Date().toISOString().slice(0,7);
      const [y,m]=month.split('-').map(Number);
      const daysInMonth = new Date(y,m,0).getDate();
      const daysWithSpend = new Set(f.filter(e=>e.date?.startsWith(month)).map(e=>e.date)).size || 1;
      const avg = total / daysWithSpend;

      target.total.textContent = fmt(total);
      target.count.textContent = `${count} transaction${count!==1?'s':''}`;
      target.top.textContent = topCat[0];
      target.topAmt.textContent = topCat[1] ? fmt(topCat[1]) : "â€”";
      target.avg.textContent = fmt(avg);
      target.days.textContent = `across ${daysWithSpend}/${daysInMonth} days`;
    }

    /* ===== Charts (modernized) ===== */
    let catChart,dailyChart,monthChart;

    // Shared chart defaults
    Chart.defaults.font.family = getComputedStyle(document.documentElement).getPropertyValue('font-family') || 'Inter, system-ui';
    Chart.defaults.color = getComputedStyle(document.documentElement).getPropertyValue('--muted').trim();
    Chart.defaults.plugins.legend.labels.boxWidth = 10;

    function gradient(ctx, from, to){
      const g = ctx.createLinearGradient(0,0,0,260);
      g.addColorStop(0, from); g.addColorStop(1, to);
      return g;
    }

    function renderCharts(f){
      const month=filterMonth.value || new Date().toISOString().slice(0,7);
      // --- Category Donut
      const catTotals = cats.map(c=>f.filter(e=>e.category===c).reduce((s,e)=>s+e.amount,0));
      const catData = {
        labels: cats,
        datasets: [{
          data: catTotals,
          borderWidth: 0,
          hoverOffset: 6
        }]
      };
      const donutOpts = {
        cutout: '62%',
        plugins: {
          legend: { position: 'right', labels: { usePointStyle:true } },
          tooltip: { callbacks: { label: (ctx)=>`${ctx.label}: ${fmt(ctx.raw)}` } }
        }
      };
      if(catChart){ catChart.data=catData; catChart.update(); }
      else { catChart=new Chart(byId("catChart").getContext("2d"), {type:"doughnut", data:catData, options:donutOpts}); }

      // --- Daily Line
      const [y,m]=month.split('-').map(Number);
      const days = new Date(y,m,0).getDate();
      const daily = Array.from({length:days},()=>0);
      f.forEach(e=>{ if(e.date?.startsWith(month)){ const d=+e.date.split('-')[2]; daily[d-1]+=e.amount; }});
      const dctx = byId("dailyChart").getContext("2d");
      const dGrad = gradient(dctx, 'rgba(96,165,250,.45)','rgba(96,165,250,0)');
      const dailyData = {
        labels: daily.map((_,i)=>String(i+1)),
        datasets: [{ label:"Daily Spend", data: daily, fill:true, backgroundColor:dGrad, borderWidth:2, pointRadius:2, tension:.35 }]
      };
      const dailyOpts = {
        maintainAspectRatio:false,
        scales:{ y:{ beginAtZero:true, ticks:{ callback:v=>'$'+v }}, x:{ grid:{ display:false }}},
        plugins:{ legend:{ display:true }, tooltip:{ callbacks:{ label:(c)=>fmt(c.parsed.y) }}}
      };
      if(dailyChart){ dailyChart.data=dailyData; dailyChart.update(); }
      else { dailyChart=new Chart(dctx,{type:"line",data:dailyData,options:dailyOpts}); }

      // --- Monthly Trend (last 6 months from data)
      const months = buildMonthBuckets(expenses, 6); // buckets from overall data (ignores filters)
      const mctx = byId("monthChart").getContext("2d");
      const mGrad = gradient(mctx, 'rgba(99,102,241,.85)','rgba(99,102,241,.35)');
      const monthData = {
        labels: months.labels,
        datasets: [{ data: months.values, borderRadius:8, backgroundColor:mGrad, maxBarThickness:40 }]
      };
      const monthOpts = {
        maintainAspectRatio:false,
        plugins:{ legend:{ display:false }, tooltip:{ callbacks:{ label:(c)=>fmt(c.parsed.y) }}},
        scales:{ y:{ beginAtZero:true, ticks:{ callback:v=>'$'+v }}, x:{ grid:{ display:false }}}
      };
      if(monthChart){ monthChart.data=monthData; monthChart.update(); }
      else { monthChart=new Chart(mctx,{type:"bar",data:monthData,options:monthOpts}); }
    }

    function buildMonthBuckets(items, count){
      // last 'count' months including current
      const now = new Date();
      const labels=[], map=new Map();
      for(let i=count-1;i>=0;i--){
        const d = new Date(now.getFullYear(), now.getMonth()-i, 1);
        const label = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        labels.push(label); map.set(label, 0);
      }
      items.forEach(e=>{
        if(!e.date) return;
        const ym = e.date.slice(0,7);
        if(map.has(ym)) map.set(ym, map.get(ym)+Number(e.amount||0));
      });
      return { labels, values: labels.map(l=>map.get(l)||0) };
    }

    /* ===== Interactions ===== */
    form.addEventListener("submit",e=>{
      e.preventDefault();
      const d={date:dateEl.value, category:catEl.value, description:descEl.value.trim(), amount:+amtEl.value};
      if(!d.date||!d.category||!d.description||!(d.amount>0)) return alert("Please complete all fields with a positive amount.");
      const id=editId.value;
      if(id){ const i=expenses.findIndex(x=>x.id===id); if(i>=0) expenses[i]={...expenses[i], ...d}; }
      else expenses.push({...d, id:uid()});
      save(); form.reset(); editId.value=""; render();
    });

    tbody.addEventListener("click",e=>{
      const btn=e.target.closest("button"); if(!btn) return;
      const id=btn.dataset.id;
      if(btn.classList.contains("delete")){
        if(confirm("Delete this expense?")){ expenses=expenses.filter(x=>x.id!==id); save(); render(); }
      } else if(btn.classList.contains("edit")){
        const x=expenses.find(x=>x.id===id); if(!x) return;
        dateEl.value=x.date; catEl.value=x.category; descEl.value=x.description; amtEl.value=x.amount; editId.value=x.id;
        window.scrollTo({top:0, behavior:"smooth"});
      }
    });

    [filterMonth,filterCat,filterTxt].forEach(el=>el.addEventListener("input",render));

    // Tabs
    tabs.exp.onclick=()=>switchTab("exp");
    tabs.dash.onclick=()=>{ switchTab("dash"); renderCharts(applyFilters(expenses)); };
    function switchTab(which){
      const on = which==="exp";
      tabs.exp.classList.toggle("active", on);
      tabs.dash.classList.toggle("active", !on);
      pages.exp.classList.toggle("active", on);
      pages.dash.classList.toggle("active", !on);
    }

    /* ===== Init ===== */
    load();
    const t=new Date(); filterMonth.value=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}`;
    render();
  </script>
</body>
</html>
